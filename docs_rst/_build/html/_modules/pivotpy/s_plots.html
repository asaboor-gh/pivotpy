

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pivotpy.s_plots &mdash; Pivotpy 0.9.8 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Pivotpy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Pivotpy API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pivotpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pivotpy.s_plots</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pivotpy.s_plots</h1><div class="highlight"><pre>
<span></span><span class="c1"># AUTOGENERATED! DO NOT EDIT! File to edit: StaticPlots.ipynb (unless otherwise specified).</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;modify_axes&#39;</span><span class="p">,</span> <span class="s1">&#39;init_figure&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_bands&#39;</span><span class="p">,</span> <span class="s1">&#39;quick_bplot&#39;</span><span class="p">,</span> <span class="s1">&#39;add_text&#39;</span><span class="p">,</span> <span class="s1">&#39;add_legend&#39;</span><span class="p">,</span> <span class="s1">&#39;add_colorbar&#39;</span><span class="p">,</span>
           <span class="s1">&#39;color_wheel&#39;</span><span class="p">,</span> <span class="s1">&#39;get_pros_data&#39;</span><span class="p">,</span> <span class="s1">&#39;make_line_collection&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_collection&#39;</span><span class="p">,</span> <span class="s1">&#39;quick_rgb_lines&#39;</span><span class="p">,</span>
           <span class="s1">&#39;quick_color_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;select_pdos&#39;</span><span class="p">,</span> <span class="s1">&#39;collect_dos&#39;</span><span class="p">,</span> <span class="s1">&#39;quick_dos_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;plt_to_html&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_potential&#39;</span><span class="p">]</span>

<span class="c1"># Cell</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span> <span class="k">as</span> <span class="n">LSC</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>

<span class="kn">import</span> <span class="nn">pivotpy.vr_parser</span> <span class="k">as</span> <span class="nn">vp</span>
<span class="kn">import</span> <span class="nn">pivotpy.g_utils</span> <span class="k">as</span> <span class="nn">gu</span>

<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">set_matplotlib_formats</span> <span class="c1">#HTML for plt_to_html</span>

<span class="c1"># print SVG in ipython</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;ZMQInteractiveShell&#39;</span> <span class="ow">or</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;Shell&#39;</span><span class="p">:</span> <span class="c1"># Shell for colab.</span>
        <span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span> <span class="c1"># Not in terminal</span>

<span class="c1"># Gloabal settings matplotlib</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1">#set the value globally</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;STIXGeneral&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;stix&quot;</span>


<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span><span class="n">xt_labels</span><span class="o">=</span><span class="p">[],</span><span class="n">xlim</span><span class="o">=</span><span class="p">[],</span>\
            <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span><span class="n">yt_labels</span><span class="o">=</span><span class="p">[],</span><span class="n">ylim</span><span class="o">=</span><span class="p">[],</span><span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
            <span class="n">vlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">zeroline</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns None, applies given settings on axes. Prefered to use before other plotting.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - ax  : Matplotlib axes object.</span>
<span class="sd">        - (x,y)ticks : List of positions on (x,y axes).</span>
<span class="sd">        - (xt,yt)_labels : List of labels on (x,y) ticks points.</span>
<span class="sd">        - (x,y)lim : [min, max] of (x,y) axes.</span>
<span class="sd">        - (x,y)label : axes labels.</span>
<span class="sd">        - vlines : If true, drawn when `ylim` is not empty.</span>
<span class="sd">        - zeroline : If True, drawn when `xlim` is not empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matplotlib axes (ax) is not given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">xticks</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xt_labels</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">yticks</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yt_labels</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">xlim</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">zeroline</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ylim</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">vlines</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
                <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">ylim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">ylim</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xticks</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">xlabel</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ylabel</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="init_figure"><a class="viewcode-back" href="../../api.html#pivotpy.s_plots.init_figure">[docs]</a><span class="k">def</span> <span class="nf">init_figure</span><span class="p">(</span><span class="n">figsize</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">2.6</span><span class="p">),</span>
                <span class="n">nrows</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">ncols</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">widths</span>    <span class="o">=</span> <span class="p">[],</span>
                <span class="n">heights</span>   <span class="o">=</span> <span class="p">[],</span>
                <span class="n">axes_off</span>  <span class="o">=</span> <span class="p">[],</span>
                <span class="n">sharex</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">sharey</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="o">**</span><span class="n">subplots_adjust_kwargs</span>
                <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns flatten axes of initialized figure, based on plt.subplots(). If you want to access parent figure, use ax.get_figure() or current figure as plt.gcf().</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - figsize   : Tuple (width, height). Default is (3.4,2.6).</span>
<span class="sd">        - nrows     : Default 1.</span>
<span class="sd">        - ncols     : Default 1.</span>
<span class="sd">        - widths    : List with len(widths)==nrows, to set width ratios of subplots.</span>
<span class="sd">        - heights   : List with len(heights)==ncols, to set height ratios of subplots.</span>
<span class="sd">        - share(x,y): Share axes between plots, this removes shared ticks automatically.</span>
<span class="sd">        - axes_off  : Turn off axes visibility, If `nrows = ncols = 1, set True/False`, If anyone of `nrows or ncols &gt; 1`, provide list of axes indices to turn off. If both `nrows and ncols &gt; 1`, provide list of tuples (x_index,y_index) of axes.</span>
<span class="sd">        - **subplots_adjust_kwargs : These are same as `plt.subplots_adjust()`&#39;s arguements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Gloabal settings matplotlib, inside figure as well</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1">#set the value globally</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;STIXGeneral&quot;</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;stix&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span><span class="mf">2.38</span><span class="p">):</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">gs_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">({})</span> <span class="c1"># Define Empty Dictionary.</span>
    <span class="k">if</span> <span class="n">widths</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span><span class="o">==</span><span class="n">ncols</span><span class="p">:</span>
        <span class="n">gs_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="o">**</span><span class="n">gs_kw</span><span class="p">,</span><span class="s1">&#39;width_ratios&#39;</span><span class="p">:</span><span class="n">widths</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">heights</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span><span class="o">==</span><span class="n">nrows</span><span class="p">:</span>
        <span class="n">gs_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="o">**</span><span class="n">gs_kw</span><span class="p">,</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span><span class="n">heights</span><span class="p">})</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">axs</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gs_kw</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nrows</span><span class="o">*</span><span class="n">ncols</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axes_off</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span> <span class="k">for</span> <span class="n">inds</span> <span class="ow">in</span> <span class="n">axes_off</span> <span class="k">if</span> <span class="n">axes_off</span><span class="o">!=</span><span class="p">[]]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="o">**</span><span class="n">subplots_adjust_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axs</span></div>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">plot_bands</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">kpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">E_Fermi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                <span class="n">color1</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span><span class="n">style1</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">lw1</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">color2</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">style2</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">lw2</span><span class="o">=</span><span class="mf">0.7</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - ax         : Matplotlib axes object, if not given, one is created.</span>
<span class="sd">        - kpath      : 1D array from `get_kpts`().kpath or `export_vasprun`().kpath.</span>
<span class="sd">        - bands      : Dictionary Object from `get_evals` or `export_vasprun`().bands.</span>
<span class="sd">        - showlegend : Boolean, default is False, if true, gives legend for spin-polarized calculations.</span>
<span class="sd">        - E_Fermi    : If not given, automatically picked from bands object.</span>
<span class="sd">        - **kwargs   : lines color,width and style to distinguish spin Up and Down.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - ax : matplotlib axes object with plotted bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fixing ax argument</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">init_figure</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">==</span><span class="n">ax</span>
    <span class="c1"># Fixing kpath argument</span>
    <span class="k">if</span><span class="p">(</span><span class="n">kpath</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;kpath is not provided. Use get_kpath() or export_vasprun().kpath to generate it.&quot;</span><span class="p">)</span>
    <span class="c1"># Fixing bands arguement</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bands</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bands object is not provided. Use get_evals() or export_vasprun().bands to generate it.&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">E_Fermi</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
       <span class="n">E_Fermi</span> <span class="o">=</span> <span class="n">bands</span><span class="o">.</span><span class="n">E_Fermi</span>
    <span class="c1"># Plotting</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bands</span><span class="o">.</span><span class="n">ISPIN</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">))</span>
        <span class="n">en</span><span class="o">=</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">-</span><span class="n">E_Fermi</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">en</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">style1</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bands</span><span class="o">.</span><span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">))</span>
        <span class="n">enUp</span><span class="o">=</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">-</span><span class="n">E_Fermi</span>
        <span class="n">enDown</span><span class="o">=</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinDown</span><span class="o">-</span><span class="n">E_Fermi</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">enUp</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">style1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">enDown</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw2</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">style2</span><span class="p">)</span>
        <span class="c1"># Legend only for spin polarized</span>
        <span class="k">if</span><span class="p">(</span><span class="n">showlegend</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">style1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spin Up&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw2</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">style2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spin Down&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="quick_bplot"><a class="viewcode-back" href="../../api.html#pivotpy.s_plots.quick_bplot">[docs]</a><span class="k">def</span> <span class="nf">quick_bplot</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">joinPathAt</span><span class="o">=</span><span class="p">[],</span><span class="n">elim</span><span class="o">=</span><span class="p">[],</span><span class="n">xt_indices</span><span class="o">=</span><span class="p">[],</span>\
            <span class="n">xt_labels</span><span class="o">=</span><span class="p">[],</span><span class="n">E_Fermi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">2.6</span><span class="p">),</span><span class="n">txt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xytxt</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.9</span><span class="p">],</span><span class="n">ctxt</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - path_evr   : path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - ax         : Matplotlib axes object, if not given, one is created.</span>
<span class="sd">        - skipk      : Number of kpoints to skip, default will be from IBZKPT.</span>
<span class="sd">        - joinPathAt : Points where kpath is broken.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - E_Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - xt_indices : High symmetry kpoints indices.abs</span>
<span class="sd">        - xt_labels  : High Symmetry kpoints labels.</span>
<span class="sd">        - **kwargs   : figsize=(3.4,2.6). Text,its position and color.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - ax : matplotlib axes object with plotted bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#checking type of given path.</span>
    <span class="k">if</span><span class="p">(</span><span class="n">path_evr</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">vr</span><span class="o">=</span><span class="n">vp</span><span class="o">.</span><span class="n">export_vasprun</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="n">skipk</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">,</span><span class="n">joinPathAt</span><span class="o">=</span><span class="n">joinPathAt</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">path_evr</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span> <span class="k">as</span> <span class="n">pt</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">path_evr</span><span class="p">)</span><span class="o">==</span><span class="n">vp</span><span class="o">.</span><span class="n">Dict2Data</span><span class="p">):</span>
            <span class="n">vr</span><span class="o">=</span><span class="n">path_evr</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_evr</span><span class="p">)):</span>
            <span class="n">vr</span><span class="o">=</span><span class="n">vp</span><span class="o">.</span><span class="n">export_vasprun</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="n">skipk</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">,</span><span class="n">joinPathAt</span><span class="o">=</span><span class="n">joinPathAt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;path_evr = `</span><span class="si">{}</span><span class="s2">` does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path_evr</span><span class="p">))</span>
    <span class="c1"># Apply a robust final check.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="p">;</span><span class="n">vr</span><span class="o">.</span><span class="n">kpath</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object: </span><span class="se">\n</span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">is like a lower tree of export_vasprun(). Expects top tree.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vr</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Main working here.</span>
        <span class="n">K</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">kpath</span>
        <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xt_indices</span><span class="p">]</span>
        <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">K</span><span class="p">)]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">elim</span><span class="p">):</span>
            <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylim</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span><span class="n">xt_labels</span><span class="o">=</span><span class="n">xt_labels</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">plot_bands</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">bands</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">E_Fermi</span><span class="o">=</span><span class="n">E_Fermi</span><span class="p">,</span><span class="n">lw1</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">txt</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">xytxt</span><span class="p">,</span><span class="n">txt</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctxt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">xytxt</span><span class="p">,</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">SYSTEM</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctxt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xs</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">ys</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">txts</span><span class="o">=</span><span class="s1">&#39;[List]&#39;</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Adds text entries on axes, given single string or list.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - xs    : List of x coordinates relative to axes or single coordinate.</span>
<span class="sd">        - ys    : List of y coordinates relative to axes or single coordinate.</span>
<span class="sd">        - txts  : List of strings or one string.</span>
<span class="sd">        - colors: List of x colors of txts or one color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matplotlib axes (ax) is not given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">txts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">txts</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">txts</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">txt</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">txts</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">txt</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">add_legend</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="p">[],</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">styles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>\
                <span class="n">widths</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Adds custom legeneds on a given axes,returns None.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - ax       : Matplotlib axes.</span>
<span class="sd">        - colors   : List of colors.</span>
<span class="sd">        - labels   : List of labels.</span>
<span class="sd">        - styles   : str or list of line styles.</span>
<span class="sd">        - widths   : str or list of line widths.</span>
<span class="sd">        - **kwargs : Matplotlib&#39;s legend arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matplotlib axes (ax) is not given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">style</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">styles</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">width</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">widths</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">style</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">widths</span><span class="p">,</span><span class="n">styles</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">add_colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmap_or_clist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="o">/</span><span class="mi">6</span><span class="p">],</span>\
            <span class="n">ticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">],</span><span class="n">vertical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Plots colorbar on a given axes. This axes should be only for colorbar. Returns None or throws ValueError for given colors.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - ax         : Matplotlib axes object.</span>
<span class="sd">        - cmap_or_clist: List/array of colors in or colormap&#39;s name. If None(default), first tries to get latest `quick_rgb_lines` colormap and if no success, then `RGB_f` colorbar is added. If nothing works, matplotlib&#39;s default colormap is plotted.</span>
<span class="sd">        - N          : int, number of color points Default 256.</span>
<span class="sd">        - ticks      : List of tick values to show on colorbar in interval [0,1].</span>
<span class="sd">        - ticklabels : List of labels for ticks.</span>
<span class="sd">        - vertical   : Boolean, default is Fasle.</span>
<span class="sd">        - fontsize   : Default 8. Adjustable according to plot space.</span>
<span class="sd">    - **Note**: Use `&#39;RGB_f&#39;` to map colors (after) plotted in `quick_rgb_lines` and use `&#39;RGB_m&#39;` to plot DOS in same colors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matplotlib axes (ax) is not given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cmap_or_clist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_hsv_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;RGB_f&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">_hsv_</span> <span class="o">=</span> <span class="n">LSC</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;_hsv_&#39;</span><span class="p">,</span><span class="n">colors</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap_or_clist</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_hsv_</span> <span class="o">=</span> <span class="n">LSC</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;_hsv_&#39;</span><span class="p">,</span><span class="n">cmap_or_clist</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Falling back to default color map!&quot;</span><span class="p">)</span>
                <span class="n">_hsv_</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># fallback</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap_or_clist</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">_hsv_</span> <span class="o">=</span> <span class="n">cmap_or_clist</span> <span class="c1">#colormap name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_hsv_</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># default fallback</span>

        <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
        <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_vals</span><span class="p">,</span><span class="n">c_vals</span><span class="p">))</span>

        <span class="n">ticks_param</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">grid_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">grid_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vertical</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">c_vals</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">_hsv_</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ticks_param</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;left&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">ticks_param</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vertical</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">c_vals</span> <span class="o">=</span> <span class="n">c_vals</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">c_vals</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">_hsv_</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ticklabels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
            <span class="n">ticks_param</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">ticks_param</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_children</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">Spine</span><span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.4</span><span class="p">))</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">color_wheel</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span>
                <span class="n">rlim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
                <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="o">/</span><span class="mi">6</span><span class="p">],</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns cax i.e. color wheel axes.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - ax        : Axes on which color wheel will be drawn. Auto created if not given.</span>
<span class="sd">        - xy        : (x,y) of center of wheel.</span>
<span class="sd">        - scale     : Scale of the cax internally generated by color wheel.</span>
<span class="sd">        - rlim      : Values in [0,1] interval, to make donut like shape.</span>
<span class="sd">        - N         : Number of segments in color wheel.</span>
<span class="sd">        - color_map : Matplotlib&#39;s color map name. Auto picks `RGB_f` and if fails, fallbacks to `viridis`.</span>
<span class="sd">        - ticks     : Ticks in fractions in interval [0,1].</span>
<span class="sd">        - labels    : Ticks labels.</span>
<span class="sd">        - showlegend: True or False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">init_figure</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">color_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">color_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;RGB_f&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">color_map</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span>
    <span class="n">cpos</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">scale</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="o">*</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">scale</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="n">scale</span><span class="p">]</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">cpos</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">rlim</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">rg</span><span class="p">,</span><span class="n">tg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">tg</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">showlegend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">)(</span><span class="n">ticks</span><span class="p">)</span> <span class="c1"># Get colors values.</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;◾ &quot;</span><span class="o">+</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
        <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="c1">#hack to write labels correctly on a single point.</span>
        <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">],</span><span class="n">colors</span><span class="p">):</span>
            <span class="n">cax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">cax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">t</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">])</span>
        <span class="n">cax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cax</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">get_pros_data</span><span class="p">(</span><span class="n">kpath</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">evals_set</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">pros_set</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">elements</span>    <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
                 <span class="n">orbs</span>        <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
                 <span class="n">interpolate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">scale_data</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">n</span>           <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                 <span class="n">k</span>           <span class="o">=</span> <span class="mi">3</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns selected elements/orbitals data.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - kapath   : `export_vasprun`().kpath or `get_kpts`().kpath.</span>
<span class="sd">        - evals_set: `export_vasprun`().bands.evals or `get_evals`().evals. If calculations are spin-polarized, it will be `...evals.SpinUp/SpinDown` for both.</span>
<span class="sd">        - pros_set : `export_vasprun().pro_bands.pros` or `get_bands_pro_set`().pros. If calculations are spin-polarized, it will be `...pros.SpinUp/SpinDown` for both.</span>
<span class="sd">        - elements : Lists of list of ions to project on, could be `range(start,stop,step)` as well, remember that `stop` is not included in python. so `range(0,2)` will generate 0 and 1 indices.</span>
<span class="sd">        - orbs     : List of lists of orbitals indices.</span>
<span class="sd">        - scale_data : If True, normalizes projection data to 1.</span>
<span class="sd">        - interpolate: Deafult is false, if True, it will add n points between nearest kpoints.</span>
<span class="sd">        - n        : int, default is 5. Adds n points between nearest kpoints.</span>
<span class="sd">        - k        : int, order of interpolation, defualt is 3. `n &gt; k` should be hold.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - A dictionary with keys &#39;kpath&#39;, &#39;evals&#39;, &#39;colors&#39; that can be unpacked in next function&#39;s arguemnet.</span>
<span class="sd">            - &#39;kpath&#39; : Given or interpolated kpath of shape (NKPTS,).</span>
<span class="sd">            - &#39;evals&#39; : Given or interpolated evals_set of shape (NKPTS,NBANDS).</span>
<span class="sd">            - &#39;pros&#39;: An array of shape (NKPTS,NBANDS,n) where n is length of input elements list. If scale_data = True, normalizes this array to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pros_set</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="s2">&quot;Can not process an empty eigenvalues/projection object.&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="s2">&quot;Try with large `elim` in parent function.&quot;</span><span class="p">))</span>
    <span class="c1"># Empty orbitals/elements are still allowed on purpose for rgb_lines.</span>
    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">orb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orb</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Items in elements and orbs should be list, tuple or range, not int.&quot;</span><span class="p">)</span>

    <span class="n">arrays_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span><span class="n">orb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">):</span>
        <span class="n">pros</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pros_set</span><span class="p">,</span><span class="n">elem</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">_pros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pros</span><span class="p">,</span><span class="n">orb</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">arrays_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_pros</span><span class="p">)</span>
    <span class="n">_shape</span>  <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrays_list</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">_pros</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">arrays_list</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">_shape</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">scale_data</span><span class="p">:</span> <span class="c1"># Normalize overall data</span>
        <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_colors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c_max</span> <span class="o">&gt;</span> <span class="mf">0.0000001</span><span class="p">:</span> <span class="c1"># Avoid division error</span>
            <span class="n">_colors</span> <span class="o">=</span> <span class="n">_colors</span><span class="o">/</span><span class="n">c_max</span>

    <span class="k">if</span><span class="p">(</span><span class="n">interpolate</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">min_d</span><span class="p">,</span> <span class="n">max_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_colors</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_colors</span><span class="p">)</span> <span class="c1"># For cliping</span>
        <span class="kn">from</span> <span class="nn">pivotpy</span> <span class="kn">import</span> <span class="n">g_utils</span> <span class="k">as</span> <span class="n">gu</span>
        <span class="n">knew</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">evals_set</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="n">_colors</span>     <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">_colors</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_d</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="n">max_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;kpath&#39;</span><span class="p">:</span><span class="n">knew</span><span class="p">,</span><span class="s1">&#39;evals&#39;</span><span class="p">:</span> <span class="n">evals</span><span class="p">,</span><span class="s1">&#39;pros&#39;</span><span class="p">:</span> <span class="n">_colors</span><span class="p">}</span>
    <span class="c1"># Return if no interpolation</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;kpath&#39;</span><span class="p">:</span><span class="n">kpath</span><span class="p">,</span><span class="s1">&#39;evals&#39;</span><span class="p">:</span> <span class="n">evals_set</span><span class="p">,</span><span class="s1">&#39;pros&#39;</span><span class="p">:</span> <span class="n">_colors</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">make_line_collection</span><span class="p">(</span><span class="n">max_width</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">colors_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">rgb</span>         <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">uni_width</span>   <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">scale_color</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">pros_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns a tuple of line collections. If rgb = True (at len(orbs) = 3 in `get_pros_data`), returns a tuple of two entries, multicolored line collection and RGB maximum values, otherwise return tuple of single colored multiple lines.</span>
<span class="sd">    - **Parametrs**</span>
<span class="sd">        - **pros_data: Output dictionary from `get_pros_data` containing kpath, evals and colors arrays.</span>
<span class="sd">        - max_width  : Default is None and max linwidth = 2.5. Max inewidth is scaled to max_width if an int of float is given.</span>
<span class="sd">        - colors_list: List of colors for multiple lines, length equal to 3rd axis length of colors.</span>
<span class="sd">        - rgb        : Default is False. If True and np.shape(colors)[-1] == 3, RGB line collection is returned in a tuple of length 1. Tuple is just to support iteration.</span>
<span class="sd">        - uni_width  : Default is False, If True, makes linewidth uniform at width = max_width/2.</span>
<span class="sd">        - scale_color: If True, normalizes each point&#39;s color value, as (0,0,0.5) --&gt; (0,0,1). If False, clips colors in range [0,1] but does not effect linewidth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pros_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No pros_data given.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kpath</span>  <span class="o">=</span> <span class="n">pros_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kpath&#39;</span><span class="p">)</span>
        <span class="n">evals</span>  <span class="o">=</span> <span class="n">pros_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evals&#39;</span><span class="p">)</span>
        <span class="n">pros</span>   <span class="o">=</span> <span class="n">pros_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pros&#39;</span><span class="p">)</span>
    <span class="n">req_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">kpath</span><span class="p">,</span> <span class="n">evals</span><span class="p">,</span> <span class="n">pros</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">kpath</span><span class="p">,</span> <span class="n">evals</span><span class="p">,</span> <span class="n">pros</span><span class="p">],[</span><span class="s1">&#39;kpath&#39;</span><span class="p">,</span> <span class="s1">&#39;evals&#39;</span><span class="p">,</span> <span class="s1">&#39;pros&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing </span><span class="si">{!r}</span><span class="s2"> from output of `get_pros_data()`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

    <span class="c1"># Average pros on two consecutive KPOINTS to get that patch color.</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">pros</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:,:]</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">pros</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># Near kpoints avearge</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">colors</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># Must before lws</span>

    <span class="c1"># Linwidths in orginal shape, but according to scale_data. Should be before scale_color</span>
    <span class="k">if</span> <span class="n">uni_width</span><span class="p">:</span>
        <span class="n">lws</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_width</span><span class="o">/</span><span class="mi">2</span> <span class="k">if</span> <span class="n">max_width</span> <span class="k">else</span> <span class="mf">2.5</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># default linewidth = 2.5 unless specified otherwise</span>
        <span class="k">if</span> <span class="n">rgb</span><span class="p">:</span> <span class="c1"># Single channel line widths</span>
            <span class="n">lws</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#residual linewidth 0.1</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># For separate lines</span>
            <span class="n">lws</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">colors</span><span class="o">.</span><span class="n">T</span> <span class="c1"># .T to access in for loop.</span>

        <span class="k">if</span> <span class="n">max_width</span><span class="p">:</span>
            <span class="c1"># here division does not fail as min(lws)==0.1</span>
            <span class="n">lws</span> <span class="o">=</span> <span class="n">max_width</span><span class="o">*</span><span class="n">lws</span><span class="o">/</span><span class="p">(</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lws</span><span class="p">))</span> <span class="c1"># Only if not None or zero.</span>

    <span class="c1"># scale_color only after linewidths</span>
    <span class="k">if</span> <span class="n">scale_color</span><span class="p">:</span> <span class="c1"># Normalize each point color</span>
        <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c_max</span><span class="p">[</span><span class="n">c_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#Avoid division error:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">colors</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">c_max</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># make sure RGB range.</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">colors_list</span><span class="p">):</span>
        <span class="n">lc_colors</span> <span class="o">=</span> <span class="n">colors_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="n">lc_colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">colors</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">lc_colors</span> <span class="o">=</span> <span class="n">lc_colors</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># Skip Alpha</span>

    <span class="c1"># Reshaping data same as colors reshaped above, nut making line patches too.</span>
    <span class="n">kgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">kpath</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">evals</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">evals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">narr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">kgrid</span><span class="p">,</span><span class="n">evals</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">evals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">marr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">narr</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span><span class="n">narr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Make Line collection</span>
    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">colors</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">_scales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Need for colorbar</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">marr</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="n">lws</span><span class="p">),</span><span class="n">_scales</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">LineCollection</span><span class="p">(</span><span class="n">marr</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">_cl</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span> <span class="k">for</span> <span class="n">_cl</span><span class="p">,</span><span class="n">lw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lc_colors</span><span class="p">,</span><span class="n">lws</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">lcs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Plots line collection from the output of get_pros_data and make_line_collection on axes.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - gpd_args: Dictionary of arguments from function `get_pros_data`. Do not unpack it.</span>
<span class="sd">        - mlc_args: Dictionary of arguments from function `make_line_collection`. Do not unpack it.</span>
<span class="sd">        - axes    : A single or list of matplotlib&#39;s Axes. len(list) should be equal to len(orbs) given in `get_pros_data`. If axes = None, auto generated.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - axes:  axes to return are spacially useful when axes = None, you can perform other actions on those axes. It will be a list of axes and all items could be same, depending on whether one are many axes were given/generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">init_figure</span><span class="p">()</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># Safe list any axes size</span>
    <span class="n">pros_data</span>  <span class="o">=</span> <span class="n">get_pros_data</span><span class="p">(</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
    <span class="n">line_coll</span>  <span class="o">=</span> <span class="n">make_line_collection</span><span class="p">(</span><span class="o">**</span><span class="n">pros_data</span><span class="p">,</span><span class="o">**</span><span class="n">mlc_args</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_coll</span><span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l_c</span> <span class="ow">in</span> <span class="n">line_coll</span><span class="p">]</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">line_coll</span><span class="p">)]</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">axes</span>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="quick_rgb_lines"><a class="viewcode-back" href="../../api.html#pivotpy.s_plots.quick_rgb_lines">[docs]</a><span class="k">def</span> <span class="nf">quick_rgb_lines</span><span class="p">(</span><span class="n">path_evr</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ax</span>          <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">skipk</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">joinPathAt</span>  <span class="o">=</span> <span class="p">[],</span>
                    <span class="n">elim</span>        <span class="o">=</span> <span class="p">[],</span>
                    <span class="n">elements</span>    <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],[],[]],</span>
                    <span class="n">orbs</span>        <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],[],[]],</span>
                    <span class="n">labels</span>      <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Elem0-s&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
                    <span class="n">max_width</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">xt_indices</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">xt_labels</span>   <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">],</span>
                    <span class="n">E_Fermi</span>     <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">figsize</span>     <span class="o">=</span> <span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">2.6</span><span class="p">),</span>
                    <span class="n">txt</span>         <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">xytxt</span>       <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.9</span><span class="p">],</span>
                    <span class="n">ctxt</span>        <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">uni_width</span>   <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">interpolate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">spin</span>        <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
                    <span class="n">n</span>           <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="n">k</span>           <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">scale_color</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">scale_data</span>  <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">colorbar</span>    <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">color_matrix</span><span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed. In this function,orbs,labels,elements all have list of length 3. Inside list, sublists or strings could be any length but should be there even if empty.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - path_evr   : path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - ax         : Matplotlib axes object, if not given, one is created.</span>
<span class="sd">        - skipk      : Number of kpoints to skip, default will be from IBZKPT.</span>
<span class="sd">        - joinPathAt : Points where kpath is broken.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - E_Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - xt_indices : High symmetry kpoints indices.abs</span>
<span class="sd">        - xt_labels  : High Symmetry kpoints labels.</span>
<span class="sd">        - elements   : List [[0],[],[]] by default and plots s orbital of first ion..</span>
<span class="sd">        - orbs       : List [[r],[g],[b]] of indices of orbitals, could be empty, but shape should be same.</span>
<span class="sd">        - labels     : List [str,str,str] of projection labels. empty string should exist to maintain shape. Auto adds `↑`,`↓` for ISPIN=2. If a label is empty i.e. &#39;&#39;, it will not show up in colorbar ticks or legend.</span>
<span class="sd">        - max_width  : Width to scale whole projections. if `uni_width=True, width=max_width/2`. Default is None and linewidth at any point = 2.5*sum(ions+orbitals projection of all three input at that point). Linewidth is scaled to max_width if an int or float is given.</span>
<span class="sd">        - figsize    : Tuple (width,height) in inches. Default (3.4.2.6) is article column&#39;s width.</span>
<span class="sd">        - txt        : Text on figure, if None, SYSTEM&#39;s name is printed.</span>
<span class="sd">        - xytxt      : [x_coord,y_coord] of text relative to axes.</span>
<span class="sd">        - ctxt       : color of text.</span>
<span class="sd">        - uni_width  : If True, width of bands kept uniform.</span>
<span class="sd">        - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">        - interpolate: Default is False, if True, bands are interpolated.</span>
<span class="sd">        - n          : int, number of points, default is 5.</span>
<span class="sd">        - k          : int, order of interpolation 0,1,2,3. Defualt 3. `n &gt; k` should be hold.</span>
<span class="sd">        - scale_color: Boolean. Default True, colors are scaled to 1 at each point. If False, clips colors in range [0,1] but does not effect linewidth.</span>
<span class="sd">        - scale_data : Default is True and normalizes projection data to 1. Has no visual effect if scale_color = True too.</span>
<span class="sd">        - colorbar   : Default is True. Displays a vertical RGB colorbar.</span>
<span class="sd">        - color_matrix: Only works if `scale_color==True`. 3x3 or 3x4 numpy array or list to transform from RGB to another space,provided that sum(color_matrix[i,:3]) &lt;= 1. 4th column, if given can be used to control the saturation,contrast and brightness as s,c,b = color_matrix[:,3] For simply changing the color intensity use np.diag([r,g,b]) with r,g,b interval in [0,1]. Try `pivotpy.color_matrix` as suggested color matrix and modify, which at s=0 returns gray scale.!</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - ax : matplotlib axes object with plotted projected bands.</span>
<span class="sd">        - Registers as colormap `RGB_m` to use in DOS to plot in same colors and `RGB_f` to display bands colorbar on another axes.</span>
<span class="sd">    &gt; Note: Two figures made by this function could be comapred quantitatively only if `scale_data=False, max_width=None, scale_color=False` as these parameters act internally on data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fix orbitals, elements and labels lengths very early.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`elements`, `orbs` and `labels` expect same length, even if empty.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path_evr</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path_evr</span> <span class="o">=</span> <span class="s1">&#39;./vasprun.xml&#39;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path_evr</span><span class="p">)</span> <span class="o">==</span> <span class="n">vp</span><span class="o">.</span><span class="n">Dict2Data</span><span class="p">:</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="n">path_evr</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_evr</span><span class="p">):</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">export_vasprun</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="n">skipk</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">,</span><span class="n">joinPathAt</span><span class="o">=</span><span class="n">joinPathAt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;path_evr = </span><span class="si">{!r}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path_evr</span><span class="p">))</span>
    <span class="c1"># Apply a robust final check.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="p">;</span><span class="n">vr</span><span class="o">.</span><span class="n">kpath</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object: </span><span class="se">\n</span><span class="si">{!r}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">does not match the output of `export_vasprun`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vr</span><span class="p">))</span>

    <span class="c1"># Main working here.</span>
    <span class="k">if</span> <span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spin can take any of [&#39;up&#39;,&#39;down&#39;. &#39;both&#39;] only.&quot;</span><span class="p">)</span>

    <span class="c1"># Elements Index fixing.</span>
    <span class="n">elem_inds</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ElemIndex</span>
    <span class="n">max_ind</span>   <span class="o">=</span> <span class="n">elem_inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># Last index is used for range in ElemIndex, not python index.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">elem_inds</span><span class="p">[</span><span class="n">elem</span><span class="p">],</span><span class="n">elem_inds</span><span class="p">[</span><span class="n">elem</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;elements[</span><span class="si">{}</span><span class="s2">] = </span><span class="si">{}</span><span class="s2"> is converted to </span><span class="si">{}</span><span class="s2"> which picks all ions of </span><span class="si">{!r}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span><span class="n">elem</span><span class="p">,</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ElemName</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
                <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;To just pick one ion at this index, wrap it in brackets [].&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Wrap elements[</span><span class="si">{}</span><span class="s2">] in [] and try again.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">max_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ee</span><span class="p">])</span>
    <span class="k">if</span>  <span class="n">max_e</span> <span class="o">&gt;</span> <span class="n">max_ind</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;index </span><span class="si">{}</span><span class="s2"> is out of bound for </span><span class="si">{}</span><span class="s2"> ions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_e</span><span class="p">,</span><span class="n">max_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Orbitals Index fixing</span>
    <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">orbs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">orbs</span><span class="p">]</span> <span class="c1">#Fix if integer given.</span>
    <span class="n">max_o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">orbs</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">])</span>
    <span class="k">if</span>  <span class="n">max_o</span> <span class="o">&gt;=</span> <span class="n">nfields</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index </span><span class="si">{}</span><span class="s2"> is out of bound for </span><span class="si">{}</span><span class="s2"> orbs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_o</span><span class="p">,</span><span class="n">nfields</span><span class="p">))</span>

    <span class="c1"># Small things</span>
    <span class="k">if</span> <span class="n">E_Fermi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">E_Fermi</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">E_Fermi</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">kpath</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xt_indices</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">K</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Make axes if not given.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">ax</span><span class="p">]):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">init_figure</span><span class="p">()</span>

    <span class="c1"># Fix color_matrix here.</span>
    <span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="c1"># Saturation, contrast, brightness. Defaults</span>
    <span class="k">if</span> <span class="n">color_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">color_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color_matrix</span><span class="p">)</span>
        <span class="n">mix_matrix</span> <span class="o">=</span> <span class="n">color_matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">color_matrix</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>

    <span class="n">colorbar_scales</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># default for colorbar</span>
    <span class="c1">#=====================================================</span>
    <span class="k">def</span> <span class="nf">_add_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="p">):</span>
        <span class="n">pros_data</span> <span class="o">=</span> <span class="n">get_pros_data</span><span class="p">(</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scale_color</span> <span class="ow">and</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">color_matrix</span><span class="p">):</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span>
            <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># ndims = 3</span>
            <span class="n">c_max</span><span class="p">[</span><span class="n">c_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#Avoid division error:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">/</span><span class="n">c_max</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">transform_color</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">mixing_matrix</span><span class="o">=</span><span class="n">mix_matrix</span><span class="p">)</span>
            <span class="n">pros_data</span><span class="p">[</span><span class="s1">&#39;pros&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="n">mlc_args</span><span class="p">[</span><span class="s1">&#39;scale_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># No more scaling in make_line_collection.</span>

        <span class="n">line_coll</span><span class="p">,</span><span class="n">scales</span> <span class="o">=</span> <span class="n">make_line_collection</span><span class="p">(</span><span class="o">**</span><span class="n">pros_data</span><span class="p">,</span><span class="o">**</span><span class="n">mlc_args</span><span class="p">)</span>
        <span class="n">colorbar_scales</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">scales</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">line_coll</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">()</span>
    <span class="c1">#====================================================</span>

    <span class="c1"># After All Fixing</span>
    <span class="n">ISPIN</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ISPIN</span>
    <span class="c1"># Arguments for get_pros_data and make_line_collection</span>
    <span class="n">gpd_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="o">=</span><span class="n">orbs</span><span class="p">,</span><span class="n">interpolate</span><span class="o">=</span><span class="n">interpolate</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">scale_data</span><span class="o">=</span><span class="n">scale_data</span><span class="p">)</span>
    <span class="n">mlc_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">uni_width</span><span class="o">=</span><span class="n">uni_width</span><span class="p">,</span><span class="n">scale_color</span> <span class="o">=</span> <span class="n">scale_color</span><span class="p">,</span><span class="n">colors_list</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ISPIN</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">gpd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">-</span><span class="n">E_Fermi</span><span class="p">,</span> <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="p">))</span>
        <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">gpd_args1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">-</span><span class="n">E_Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinUp</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="n">gpd_args2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinDown</span><span class="o">-</span><span class="n">E_Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinDown</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span><span class="p">):</span>
            <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args1</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span><span class="p">):</span>
            <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args2</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">spin</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
            <span class="c1"># Plotting Up</span>
            <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args1</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="c1"># Plotting Down</span>
            <span class="n">_add_collection</span><span class="p">(</span><span class="n">gpd_args2</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># Aethetcis of plot.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">txt</span><span class="p">:</span>
        <span class="n">txt</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">SYSTEM</span>
    <span class="n">add_text</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">xs</span><span class="o">=</span><span class="n">xytxt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ys</span><span class="o">=</span><span class="n">xytxt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">txts</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">ctxt</span><span class="p">)</span>
    <span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span><span class="n">xt_labels</span><span class="o">=</span><span class="n">xt_labels</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span>
    <span class="c1"># Colorbar and Colormap</span>
    <span class="n">_colors_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span><span class="n">colorbar_scales</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scale_color</span> <span class="ow">and</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">color_matrix</span><span class="p">):</span> <span class="c1"># Only apply color_matrix on scaled colors</span>
        <span class="n">zero_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colorbar_scales</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mix_matrix</span><span class="p">[</span><span class="n">zero_inds</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># No mixing for zero projection.</span>
        <span class="n">_colors_</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">transform_color</span><span class="p">(</span><span class="n">_colors_</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">mixing_matrix</span><span class="o">=</span><span class="n">mix_matrix</span><span class="p">)</span>
    <span class="c1"># register a colormap to use in DOS of same color</span>
    <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span> <span class="k">as</span> <span class="n">LSC</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">register_cmap</span><span class="p">(</span><span class="s1">&#39;RGB_f&#39;</span><span class="p">,</span><span class="n">LSC</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;RGB_f&#39;</span><span class="p">,</span><span class="n">_colors_</span><span class="p">))</span> <span class="c1">#Register cmap for Bands</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">register_cmap</span><span class="p">(</span><span class="s1">&#39;RGB_m&#39;</span><span class="p">,</span><span class="n">LSC</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;RGB_m&#39;</span><span class="p">,</span><span class="n">_colors_</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="c1">#Register cmap for DOS</span>

    <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
        <span class="n">_tls_</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span> <span class="c1"># To avoid side effects, new labels array.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">and</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">_tls_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↑$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↓$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^{↑↓}$&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="n">w_f</span> <span class="o">=</span> <span class="mf">0.15</span><span class="o">/</span><span class="n">w</span> <span class="c1"># width of colorbar relative to fontsize=8</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="c1"># Make colobar space available from given axis itself</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">pos</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span><span class="o">-</span><span class="mf">2.8</span><span class="o">*</span><span class="n">w_f</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="p">])</span>
        <span class="n">new_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">pos</span><span class="o">.</span><span class="n">width</span><span class="o">-</span><span class="n">w_f</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span><span class="n">w_f</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
        <span class="n">axb</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">new_pos</span><span class="p">)</span>
        <span class="n">add_colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axb</span><span class="p">,</span><span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ticklabels</span><span class="o">=</span><span class="n">_tls_</span><span class="p">,</span><span class="n">cmap_or_clist</span> <span class="o">=</span> <span class="n">_colors_</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="quick_color_lines"><a class="viewcode-back" href="../../api.html#pivotpy.s_plots.quick_color_lines">[docs]</a><span class="k">def</span> <span class="nf">quick_color_lines</span><span class="p">(</span><span class="n">path_evr</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">axes</span>          <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">skipk</span>         <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">joinPathAt</span>    <span class="o">=</span> <span class="p">[],</span>
                      <span class="n">elim</span>          <span class="o">=</span> <span class="p">[],</span>
                      <span class="n">elements</span>      <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]],</span>
                      <span class="n">orbs</span>          <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]],</span>
                      <span class="n">labels</span>        <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                      <span class="n">color_map</span>     <span class="o">=</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">,</span>
                      <span class="n">scale_data</span>    <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">max_width</span>     <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">spin</span>          <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
                      <span class="n">xt_indices</span>    <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">xt_labels</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">Gamma$&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">],</span>
                      <span class="n">E_Fermi</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">showlegend</span>    <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">figsize</span>       <span class="o">=</span> <span class="p">(</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">),</span>
                      <span class="n">txt</span>           <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="n">xytxt</span>         <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">],</span>
                      <span class="n">ctxt</span>          <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                      <span class="n">interpolate</span>   <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">n</span>             <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                      <span class="n">k</span>             <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                      <span class="n">legend_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ncol&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span>
                                     <span class="s1">&#39;handletextpad&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;handlelength&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                     <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                       <span class="o">**</span><span class="n">subplots_adjust_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns axes object and plot on which all matplotlib allowed actions could be performed. If given, elements, orbs, and labels must have same length. If not given, zeroth ion is plotted with s-orbital.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - path_evr   : Path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - axes       : Matplotlib axes object with one or many axes, if not given, auto created.</span>
<span class="sd">        - skipk      : Number of kpoints to skip, default will be from IBZKPT.</span>
<span class="sd">        - joinPathAt : Points where kpath is broken.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - E_Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - xt_indices : High symmetry kpoints indices.abs</span>
<span class="sd">        - xt_labels  : High Symmetry kpoints labels.</span>
<span class="sd">        - elements   : List [[0],], by defualt and plot first ion&#39;s projections.</span>
<span class="sd">        - orbs       : List [[0],] lists of indices of orbitals, could be empty.</span>
<span class="sd">        - labels     : List [str,] of orbitals labels. len(labels)==len(orbs) must hold.  Auto adds `↑`,`↓` for ISPIN=2. If a label is empty i.e. &#39;&#39;, it will not show up in legend.</span>
<span class="sd">        - color_map  : Matplotlib&#39;s standard color maps. Default is &#39;gist_ranibow&#39;.</span>
<span class="sd">        - showlegend : True by defualt and displays legend relative to axes[0]. If False, it writes text on individual ax.</span>
<span class="sd">        - scale_data : Default is False, If True, normalize projection data to 1.</span>
<span class="sd">        - max_width  : Width to scale whole projections. Default is None and linewidth at any point on a line = 2.5*sum(ions+orbitals projection of the input for that line at that point). Linewidth is scaled to max_width if an int or float is given.</span>
<span class="sd">        - figsize    : Tuple (width,height) in inches. Default (3.4.2.6) is article column&#39;s width.</span>
<span class="sd">        - txt        : Text on figure, if None, SYSTEM&#39;s name is printed.</span>
<span class="sd">        - xytxt      : [x_coord,y_coord] of text relative to axes.</span>
<span class="sd">        - ctxt       : color of text.</span>
<span class="sd">        - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">        - interpolate: Default is False, if True, bands are interpolated.</span>
<span class="sd">        - n          : int, number of points, default is 5.</span>
<span class="sd">        - k          : int, order of interpolation 0,1,2,3. Defualt 3. `n &gt; k` should be hold.</span>
<span class="sd">        - legend_kwargs: Dictionary containing legend arguments.</span>
<span class="sd">        - **subplots_adjust_kwargs : plt.subplots_adjust parameters.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - ax : matplotlib axes object with plotted projected bands.</span>
<span class="sd">    &gt; Note: Two figures made by this function could be comapred quantitatively only if `scale_data=False, max_width=None` as these parameters act internally on data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fix orbitals, elements and labels lengths very early.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`elements`, `orbs` and `labels` expect same length, even if empty.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path_evr</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path_evr</span> <span class="o">=</span> <span class="s1">&#39;./vasprun.xml&#39;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path_evr</span><span class="p">)</span> <span class="o">==</span> <span class="n">vp</span><span class="o">.</span><span class="n">Dict2Data</span><span class="p">:</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="n">path_evr</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_evr</span><span class="p">):</span>
        <span class="n">vr</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">export_vasprun</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">skipk</span><span class="o">=</span><span class="n">skipk</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">,</span><span class="n">joinPathAt</span><span class="o">=</span><span class="n">joinPathAt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;path_evr = </span><span class="si">{!r}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path_evr</span><span class="p">))</span>
    <span class="c1"># Apply a robust final check.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="p">;</span><span class="n">vr</span><span class="o">.</span><span class="n">kpath</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object: </span><span class="se">\n</span><span class="si">{!r}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">does not match the output of `export_vasprun`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vr</span><span class="p">))</span>

    <span class="c1"># Main working here.</span>
    <span class="k">if</span> <span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty eigenvalues object.&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spin can take any of [&#39;up&#39;,&#39;down&#39;. &#39;both&#39;] only.&quot;</span><span class="p">)</span>

    <span class="c1"># Elements Index fixing.</span>
    <span class="n">elem_inds</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ElemIndex</span>
    <span class="n">max_ind</span>   <span class="o">=</span> <span class="n">elem_inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># Last index is used for range in ElemIndex, not python index.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">elem_inds</span><span class="p">[</span><span class="n">elem</span><span class="p">],</span><span class="n">elem_inds</span><span class="p">[</span><span class="n">elem</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;elements[</span><span class="si">{}</span><span class="s2">] = </span><span class="si">{}</span><span class="s2"> is converted to </span><span class="si">{}</span><span class="s2"> which picks all ions of </span><span class="si">{!r}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">elem</span><span class="p">,</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ElemName</span><span class="p">[</span><span class="n">elem</span><span class="p">])</span>
                <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;To just pick one ion at this index, wrap it in brackets [].&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Wrap elements[</span><span class="si">{}</span><span class="s2">] in [] and try again.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">max_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ee</span><span class="p">])</span>
    <span class="k">if</span>  <span class="n">max_e</span> <span class="o">&gt;</span> <span class="n">max_ind</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;index </span><span class="si">{}</span><span class="s2"> is out of bound for </span><span class="si">{}</span><span class="s2"> ions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_e</span><span class="p">,</span><span class="n">max_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Orbitals Index fixing</span>
    <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">orbs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="k">else</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">orbs</span><span class="p">]</span> <span class="c1">#Fix if integer given.</span>
    <span class="n">max_o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">orbs</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">])</span>
    <span class="k">if</span>  <span class="n">max_o</span> <span class="o">&gt;=</span> <span class="n">nfields</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index </span><span class="si">{}</span><span class="s2"> is out of bound for </span><span class="si">{}</span><span class="s2"> orbs&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_o</span><span class="p">,</span><span class="n">nfields</span><span class="p">))</span>
    <span class="c1"># Small things</span>
    <span class="k">if</span> <span class="n">E_Fermi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">E_Fermi</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">E_Fermi</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">kpath</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xt_indices</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">K</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">K</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Fix elements and colors length. ISPIN 2 case is done in loop itself</span>
    <span class="k">if</span> <span class="n">color_map</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="p">():</span>
        <span class="n">c_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;color_map = </span><span class="si">{!r}</span><span class="s2"> not exists, falling back to default color map.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color_map</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">)</span>
    <span class="n">c_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">))</span>
    <span class="n">colors</span>  <span class="o">=</span> <span class="n">c_map</span><span class="p">(</span><span class="n">c_vals</span><span class="p">)</span>

    <span class="c1"># After All Fixing</span>
    <span class="n">ISPIN</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ISPIN</span>
    <span class="c1"># Arguments for get_pros_data and make_line_collection</span>
    <span class="n">gpd_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="o">=</span><span class="n">orbs</span><span class="p">,</span><span class="n">interpolate</span><span class="o">=</span><span class="n">interpolate</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">scale_data</span><span class="o">=</span><span class="n">scale_data</span><span class="p">)</span>
    <span class="n">mlc_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rgb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">uni_width</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">scale_color</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">colors_list</span><span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">ISPIN</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">gpd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">-</span><span class="n">E_Fermi</span><span class="p">,</span><span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">plot_collection</span><span class="p">(</span><span class="n">gpd_args</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ISPIN</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">gpd_args1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinUp</span><span class="o">-</span><span class="n">E_Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinUp</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="n">gpd_args2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kpath</span><span class="o">=</span><span class="n">K</span><span class="p">,</span><span class="n">evals_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">evals</span><span class="o">.</span><span class="n">SpinDown</span><span class="o">-</span><span class="n">E_Fermi</span><span class="p">,</span>
                        <span class="n">pros_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_bands</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinDown</span><span class="p">,</span><span class="o">**</span><span class="n">gpd_args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plot_collection</span><span class="p">(</span><span class="n">gpd_args1</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plot_collection</span><span class="p">(</span><span class="n">gpd_args2</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plot_collection</span><span class="p">(</span><span class="n">gpd_args1</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
            <span class="c1"># Axes from above are reused in spin down plot. to avoid double graph</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plot_collection</span><span class="p">(</span><span class="n">gpd_args2</span><span class="p">,</span><span class="n">mlc_args</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>

    <span class="c1"># Aesthetics</span>
    <span class="n">_tls_</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span> <span class="c1"># To avoid side effects, new labels array.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">and</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">_tls_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↑$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↓$&#39;</span> <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span> <span class="k">else</span> <span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^{↑↓}$&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">showlegend</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_width</span><span class="o">/</span><span class="mi">2</span> <span class="k">if</span> <span class="n">max_width</span> <span class="k">else</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">add_legend</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">_tls_</span><span class="p">,</span><span class="n">widths</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">xytxt</span><span class="p">]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_text</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">xs</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">ys</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">txts</span><span class="o">=</span><span class="n">_tl_</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">ctxt</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">_tl_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">_tls_</span><span class="p">)]</span>
    <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">modify_axes</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span><span class="n">xt_labels</span><span class="o">=</span><span class="n">xt_labels</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="o">**</span><span class="n">subplots_adjust_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axes</span></div>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">select_pdos</span><span class="p">(</span><span class="n">tdos</span>        <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">pdos_set</span>    <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">ions</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,],</span>
                <span class="n">orbs</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,],</span>
                <span class="n">E_Fermi</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">interpolate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">n</span>           <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                <span class="n">k</span>           <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                 <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns (interpolated/orginal) enrgy(N,), tdos(N,), and pdos(N,) of selected ions/orbitals.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - tdos     : `export_vasprun`().tdos or `get_tdos`().tdos. If calculations are spin-polarized, it will be `..tdos.SpinUp/SpinDown` for both. You need to apply this function twice for SpinUp and SpinDown separately.</span>
<span class="sd">        - pdos_set : `export_vasprun().pro_dos.pros` or `get_dos_pro_set`().pros. If calculations are spin-polarized, it will be `...pros.SpinUp/SpinDown` for both.</span>
<span class="sd">        - ions     : List of ions to project on, could be `range(start,stop,step)` as well, remember that `stop` is not included in python. so `range(0,2)` will generate 0 and 1 indices.</span>
<span class="sd">        - orbs     : List of orbitals indices to pick.</span>
<span class="sd">        - E_Fermi  : Here it is zero. Needs to be input.</span>
<span class="sd">        - interpolate: Deafult is false, if True, it will add n points between nearest points.</span>
<span class="sd">        - n        : int, default is 5. Adds n points between nearest kpoints.</span>
<span class="sd">        - k        : int, order of interpolation, defualt is 3. `n &gt; k` should be hold.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tdos</span><span class="o">==</span><span class="p">[]:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="s2">&quot;Can not plot empty DOS.&quot;</span><span class="p">))</span>
    <span class="n">en</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">E_Fermi</span>
    <span class="n">t_dos</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pdos_set</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">:],</span><span class="nb">list</span><span class="p">(</span><span class="n">ions</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">p_dos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">pros</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interpolate</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pivotpy</span> <span class="kn">import</span> <span class="n">g_utils</span> <span class="k">as</span> <span class="n">gu</span>
        <span class="n">_en</span><span class="p">,</span><span class="n">_tdos</span><span class="o">=</span><span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">t_dos</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="n">_tdos</span><span class="o">=</span><span class="n">_tdos</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">_en</span><span class="p">,</span><span class="n">_pdos</span><span class="o">=</span><span class="n">gu</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p_dos</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_en</span><span class="p">,</span><span class="n">_tdos</span><span class="p">,</span><span class="n">_pdos</span><span class="o">=</span><span class="n">pdos_set</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">E_Fermi</span><span class="p">,</span><span class="n">t_dos</span><span class="p">,</span><span class="n">p_dos</span> <span class="c1"># reading _en from projected dos if not interpolated.</span>

    <span class="k">return</span> <span class="n">_en</span><span class="p">,</span><span class="n">_tdos</span><span class="p">,</span><span class="n">_pdos</span>

<span class="c1"># Cell</span>
<span class="k">def</span> <span class="nf">collect_dos</span><span class="p">(</span><span class="n">path_evr</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">elim</span>          <span class="o">=</span> <span class="p">[],</span>
                <span class="n">elements</span>      <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
                <span class="n">orbs</span>          <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
                <span class="n">labels</span>        <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,],</span>
                <span class="n">E_Fermi</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">spin</span>          <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
                <span class="n">interpolate</span>   <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">n</span>             <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                <span class="n">k</span>             <span class="o">=</span> <span class="mi">3</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns lists of energy,tdos, pdos and labels. If given,elements,orbs and labels must have same length. If not given, zeroth ions is collected with s-orbital.</span>
<span class="sd">    - **Parameters**)</span>
<span class="sd">        - path_evr   : Path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">        - elim       : [min,max] of energy range.</span>
<span class="sd">        - E_Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">        - elements   : List [[0],], by defualt and plot first ion&#39;s projections.</span>
<span class="sd">        - orbs       : List [[0],] lists of indices of orbitals, could be empty.</span>
<span class="sd">        - labels     : List [str,] of orbitals labels. len(labels)==len(orbs) must hold.  Auto adds `↑`,`↓` for ISPIN=2.</span>
<span class="sd">        - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">        - interpolate: Default is False, if True, bands are interpolated.</span>
<span class="sd">        - n          : int, number of points, default is 5.</span>
<span class="sd">        - k          : int, order of interpolation 0,1,2,3. Defualt 3. `n &gt; k` should be hold.</span>
<span class="sd">    - **Returns**</span>
<span class="sd">        - Energy : (N,1) size.</span>
<span class="sd">        - tdos   : (N,1) size or [(N,1),(N,1)] if spin polarized.</span>
<span class="sd">        - pdos   : [(N,1),(N,1),...], spin polarized is auto-fixed.</span>
<span class="sd">        - labels : [&#39;label1,&#39;label2&#39;,...] spin polarized is auto-fixed.</span>
<span class="sd">        - vr     : Exported vasprun.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#checking type of given path.</span>
    <span class="k">if</span><span class="p">(</span><span class="n">path_evr</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">vr</span><span class="o">=</span><span class="n">vp</span><span class="o">.</span><span class="n">export_vasprun</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">path_evr</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">path_evr</span><span class="p">)</span><span class="o">==</span><span class="n">vp</span><span class="o">.</span><span class="n">Dict2Data</span><span class="p">):</span>
            <span class="n">vr</span><span class="o">=</span><span class="n">path_evr</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_evr</span><span class="p">)):</span>
            <span class="n">vr</span><span class="o">=</span><span class="n">vp</span><span class="o">.</span><span class="n">export_vasprun</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span><span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;path_evr = `</span><span class="si">{}</span><span class="s2">` does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path_evr</span><span class="p">))</span>
    <span class="c1"># Apply a robust final check.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="p">;</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object: </span><span class="se">\n</span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">is like a lower tree of export_vasprun(). Expects top tree.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vr</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Main working here.</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="s2">&quot;Can not plot an empty DOS object.&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;spin can take `up`,`down` or `both` values only.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">orbs</span><span class="o">=</span><span class="p">[[</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span> <span class="k">else</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">orbs</span><span class="p">]</span> <span class="c1">#Fix if integer given.</span>
        <span class="n">elements</span><span class="o">=</span><span class="p">[[</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span> <span class="k">else</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]</span> <span class="c1">#Fix if integer given.</span>
        <span class="n">elem_inds</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ElemIndex</span>
        <span class="n">max_ind</span>   <span class="o">=</span> <span class="n">elem_inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># Last index is used for range in ElemIndex, not python index.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()):</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">elem</span> <span class="o">&lt;=</span> <span class="n">max_ind</span><span class="p">):</span>
                    <span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index </span><span class="si">{}</span><span class="s2"> is out of bound for ions of length </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">max_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">E_Fermi</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">E_Fermi</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">E_Fermi</span>

        <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1">#</span>
        <span class="c1"># First fix orbitals</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;elements, orbs and labels expect same length even if their entries are empty.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># After All Fixing</span>
        <span class="n">ISPIN</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">sys_info</span><span class="o">.</span><span class="n">ISPIN</span>
        <span class="n">e</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span><span class="n">ps</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,[],[]</span> <span class="c1"># to collect all total/projected dos.</span>
        <span class="k">for</span> <span class="n">elem</span><span class="p">,</span><span class="n">orb</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span><span class="n">orbs</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">args_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ions</span><span class="o">=</span><span class="n">elem</span><span class="p">,</span><span class="n">orbs</span><span class="o">=</span><span class="n">orb</span><span class="p">,</span><span class="n">interpolate</span><span class="o">=</span><span class="n">interpolate</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">E_Fermi</span><span class="o">=</span><span class="n">E_Fermi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">tdos</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">tdos</span>
                <span class="n">pdos_set</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">pros</span>
                <span class="n">e</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">if</span> <span class="n">ISPIN</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">tdos1</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">SpinUp</span>
                <span class="n">tdos2</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">tdos</span><span class="o">.</span><span class="n">SpinDown</span>
                <span class="n">pdos_set1</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinUp</span>
                <span class="n">pdos_set2</span><span class="o">=</span><span class="n">vr</span><span class="o">.</span><span class="n">pro_dos</span><span class="o">.</span><span class="n">pros</span><span class="o">.</span><span class="n">SpinDown</span>
                <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;up&#39;</span><span class="p">:</span>
                    <span class="n">e</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">p1</span> <span class="o">=</span> <span class="n">select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos1</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set1</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                    <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                    <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↑$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">ts</span> <span class="o">=</span> <span class="n">t1</span>
                <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;down&#39;</span><span class="p">:</span>
                    <span class="n">e</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">p2</span> <span class="o">=</span> <span class="n">select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos2</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set2</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                    <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
                    <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↓$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">ts</span> <span class="o">=</span> <span class="n">t2</span>
                <span class="k">if</span> <span class="n">spin</span><span class="o">==</span><span class="s1">&#39;both&#39;</span><span class="p">:</span>
                    <span class="n">e</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">p1</span> <span class="o">=</span> <span class="n">select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos1</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set1</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                    <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                    <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↑$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">e</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">p2</span> <span class="o">=</span> <span class="n">select_pdos</span><span class="p">(</span><span class="n">tdos</span><span class="o">=</span><span class="n">tdos2</span><span class="p">,</span><span class="n">pdos_set</span><span class="o">=</span><span class="n">pdos_set2</span><span class="p">,</span> <span class="o">**</span><span class="n">args_dict</span><span class="p">)</span>
                    <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span>
                    <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39;$^↓$&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">ts</span><span class="o">=</span><span class="p">[</span><span class="n">t1</span><span class="p">,</span><span class="o">-</span><span class="n">t2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">e</span><span class="p">,</span><span class="n">ts</span><span class="p">,</span><span class="n">ps</span><span class="p">,</span><span class="n">ls</span><span class="p">,</span><span class="n">vr</span>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="quick_dos_lines"><a class="viewcode-back" href="../../api.html#pivotpy.s_plots.quick_dos_lines">[docs]</a><span class="k">def</span> <span class="nf">quick_dos_lines</span><span class="p">(</span><span class="n">path_evr</span>      <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ax</span>            <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">elim</span>          <span class="o">=</span> <span class="p">[],</span>
                    <span class="n">include_dos</span>   <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
                    <span class="n">elements</span>      <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
                    <span class="n">orbs</span>          <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],],</span>
                    <span class="n">labels</span>        <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,],</span>
                    <span class="n">color_map</span>     <span class="o">=</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">,</span>
                    <span class="n">tdos_color</span>    <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span>
                    <span class="n">linewidth</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">fill_area</span>     <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">vertical</span>      <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">E_Fermi</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">figsize</span>       <span class="o">=</span> <span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">2.6</span><span class="p">),</span>
                    <span class="n">txt</span>           <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">xytxt</span>         <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.85</span><span class="p">],</span>
                    <span class="n">ctxt</span>          <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">spin</span>          <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
                    <span class="n">interpolate</span>   <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">n</span>             <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="n">k</span>             <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">showlegend</span>    <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">legend_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ncol&#39;</span>         <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                                   <span class="s1">&#39;anchor&#39;</span>         <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                   <span class="s1">&#39;handletextpad&#39;</span>  <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                                   <span class="s1">&#39;handlelength&#39;</span>   <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="s1">&#39;fontsize&#39;</span>       <span class="p">:</span> <span class="s1">&#39;small&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;frameon&#39;</span>        <span class="p">:</span> <span class="kc">False</span>
                                   <span class="p">}</span>

                    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        - Returns ax object (if ax!=False) and plot on which all matplotlib allowed actions could be performed, returns lists of energy,tdos and pdos and labels. If given,elements,orbs colors, and labels must have same length. If not given, zeroth ions is plotted with s-orbital.</span>
<span class="sd">        - **Parameters**)</span>
<span class="sd">            - path_evr   : Path/to/vasprun.xml or output of `export_vasprun`. Auto picks in CWD.</span>
<span class="sd">            - ax         : Matplotlib axes object, if None, one is created. If False, data lists are returned.</span>
<span class="sd">            - include_dos: One of {&#39;both&#39;,&#39;tdos&#39;,&#39;pdos&#39;}.</span>
<span class="sd">            - elim       : [min,max] of energy range.</span>
<span class="sd">            - E_Fermi    : If not given, automatically picked from `export_vasprun`.</span>
<span class="sd">            - elements   : List [[0],], by defualt and plot first ion&#39;s projections.</span>
<span class="sd">            - orbs       : List [[0],] lists of indices of orbitals, could be empty.</span>
<span class="sd">            - labels     : List [str,] of orbitals labels. len(labels)==len(orbs) must hold.  Auto adds `↑`,`↓` for ISPIN=2.</span>
<span class="sd">            - color_map  : Matplotlib&#39;s standard color maps. Default is &#39;gist_ranibow&#39;. Use &#39;RGB&#39; if want to compare with `quick_rgb_lines` with 3 projection inputs (len(orbs)==3).</span>
<span class="sd">            - fill_area  : Default is True and plots filled area for dos. If False, plots lines only.</span>
<span class="sd">            - vertical   : False, If True, plots along y-axis.</span>
<span class="sd">            - showlegend : True by defualt.</span>
<span class="sd">            - figsize    : Tuple (width,height) in inches. Default (3.4.2.6) is article column&#39;s width.</span>
<span class="sd">            - txt        : Text on figure, if None, SYSTEM&#39;s name is printed.</span>
<span class="sd">            - xytxt      : [x_coord,y_coord] of text relative to axes.</span>
<span class="sd">            - ctxt       : color of text.</span>
<span class="sd">            - spin       : Plot spin-polarized for spin {&#39;up&#39;,&#39;down&#39;,&#39;both&#39;}. Default is both.</span>
<span class="sd">            - interpolate: Default is False, if True, bands are interpolated.</span>
<span class="sd">            - n          : int, number of points, default is 5.</span>
<span class="sd">            - k          : int, order of interpolation 0,1,2,3. Defualt 3. `n &gt; k` should be hold.</span>
<span class="sd">            - legend_kwargs: Dictionary to contain legend arguments to fix.</span>
<span class="sd">        - **Returns**</span>
<span class="sd">            - ax         : Matplotlib axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span><span class="s1">&#39;pdos&#39;</span><span class="p">,</span><span class="s1">&#39;tdos&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;`include_dos` expects one of [&#39;both&#39;,&#39;pdos&#39;,&#39;tdos&#39;], got </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">include_dos</span><span class="p">))</span>

        <span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">pdos</span><span class="p">,</span><span class="n">vr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span> <span class="c1"># Placeholders for defining. must be here.</span>
        <span class="n">cl_dos</span><span class="o">=</span><span class="n">collect_dos</span><span class="p">(</span><span class="n">path_evr</span><span class="o">=</span><span class="n">path_evr</span><span class="p">,</span>
                            <span class="n">elim</span><span class="o">=</span><span class="n">elim</span><span class="p">,</span>
                            <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span>
                            <span class="n">orbs</span><span class="o">=</span><span class="n">orbs</span><span class="p">,</span>
                            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                            <span class="n">E_Fermi</span><span class="o">=</span><span class="n">E_Fermi</span><span class="p">,</span>
                            <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span>
                            <span class="n">interpolate</span><span class="o">=</span><span class="n">interpolate</span><span class="p">,</span>
                            <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">vr</span><span class="o">=</span><span class="n">cl_dos</span> <span class="c1"># Labels updated</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.g_utils</span> <span class="kn">import</span> <span class="n">color</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">gu</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="s2">&quot;Try with large energy range.&quot;</span><span class="p">))</span>
        <span class="c1"># Fix elements and colors length</span>
        <span class="k">if</span> <span class="n">color_map</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">cm</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">c_map</span>   <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">)</span>
                <span class="n">c_vals</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">))</span>
                <span class="n">colors</span>  <span class="o">=</span> <span class="n">c_map</span><span class="p">(</span><span class="n">c_vals</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c_map</span>   <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">)</span>
                <span class="n">c_vals</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">))</span>
                <span class="n">colors</span>  <span class="o">=</span> <span class="n">c_map</span><span class="p">(</span><span class="n">c_vals</span><span class="p">)</span>
            <span class="c1"># Fix for RGB comparison</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s1">&#39;both&#39;</span> <span class="ow">in</span> <span class="n">spin</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">colors</span><span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span> <span class="n">colors</span><span class="p">[[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="c1">#Flip last two colors only</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;`color_map` expects one of the follwoing:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="p">()))</span>

        <span class="c1"># Make additional colors for spin down. Inverted colors are better.</span>
        <span class="n">t_color</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">tdos_color</span><span class="p">)</span>
        <span class="n">it_color</span><span class="o">=</span><span class="n">gu</span><span class="o">.</span><span class="n">transform_color</span><span class="p">(</span><span class="n">t_color</span><span class="p">,</span><span class="n">c</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 contrast inverts color</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ax</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">init_figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vertical</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">fill_area</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;pdos&#39;</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↑$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↓$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;tdos&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">fill_area</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;pdos&#39;</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↑$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↓$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;tdos&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)),</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)])</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vertical</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">fill_area</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;pdos&#39;</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">en</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↑$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">en</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↓$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tdos</span><span class="p">,</span><span class="n">en</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;tdos&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">en</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">fill_area</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;pdos&#39;</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdos</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>   <span class="c1"># Spin polarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↑$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">it_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TDOS$^↓$&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>   <span class="c1"># unpolarized.</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">tdos</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">t_color</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TDOS&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">include_dos</span><span class="o">!=</span><span class="s1">&#39;tdos&#39;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)),</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">en</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elim</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">elim</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">elim</span><span class="p">)])</span>
        <span class="k">if</span><span class="p">(</span><span class="n">showlegend</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">add_legend</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">widths</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="plt_to_html"><a class="viewcode-back" href="../../api.html#pivotpy.s_plots.plt_to_html">[docs]</a><span class="k">def</span> <span class="nf">plt_to_html</span><span class="p">(</span><span class="n">plt_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dash_html</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns base64 encoded Image to display in notebook or HTML &lt;svg&gt; or plotly&#39;s dash_html_components.Img object.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - plt_fig    : Matplotlib&#39;s figure instance, auto picks as well.</span>
<span class="sd">        - transparent: True of False for fig background.</span>
<span class="sd">        - dash_html  : Default is None which results in an image display in jupyter notebook.</span>
<span class="sd">            - If True, returns html.Img object for plotly&#39;s dash.</span>
<span class="sd">            - If False, returns &lt;svg&gt; object to embed in HTML DOM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plt_fig</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">plt_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">plot_bytes</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_bytes</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span><span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dash_html</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;ZMQInteractiveShell&#39;</span> <span class="ow">or</span> <span class="n">shell</span><span class="o">==</span><span class="s1">&#39;Shell&#39;</span><span class="p">:</span> <span class="c1">#Shell for Colab. Don&#39;t know why Google ...</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span> <span class="c1"># Clear other display</span>
                <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;svg&#39;</span> <span class="o">+</span> <span class="n">plot_bytes</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;svg&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">dash_html</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span> <span class="c1"># Clear image</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;svg&#39;</span> <span class="o">+</span> <span class="n">plot_bytes</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;svg&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">base64</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span> <span class="c1"># Clear image</span>
        <span class="kn">import</span> <span class="nn">dash_html_components</span> <span class="k">as</span> <span class="nn">html</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">plot_bytes</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Img</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;data:image/svg+xml;base64,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)))</span></div>

<span class="c1"># Cell</span>
<div class="viewcode-block" id="plot_potential"><a class="viewcode-back" href="../../api.html#pivotpy.s_plots.plot_potential">[docs]</a><span class="k">def</span> <span class="nf">plot_potential</span><span class="p">(</span><span class="n">basis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">e_or_m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">operation</span><span class="o">=</span><span class="s1">&#39;mean_z&#39;</span><span class="p">,</span>
           <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">period</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">lr_pos</span><span class="o">=</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">),</span>
           <span class="n">lr_widths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
           <span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V(z)$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\langle V \rangle _</span><span class="si">{roll}</span><span class="s1">(z)$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\langle V \rangle $&#39;</span><span class="p">),</span>
           <span class="n">colors</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">),</span>
           <span class="n">annotate</span> <span class="o">=</span> <span class="kc">True</span>
          <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Returns tuple(ax,Data) where Data contains resultatnt parameters of averaged potential of LOCPOT.</span>
<span class="sd">    - **Parameters**</span>
<span class="sd">        - basis  : `export_potential().basis`.</span>
<span class="sd">        - e_or_m : `epxort_potential().[e,m,m_x,m_y,m_z]` is 3D grid data. As `epxort_potential` is slow, so compute it once and then plot the output data.</span>
<span class="sd">        - operation: Default is &#39;mean_z&#39;. What to do with provided volumetric potential data. Anyone of these &#39;mean_x&#39;,&#39;min_x&#39;,&#39;max_x&#39;,&#39;mean_y&#39;,&#39;min_y&#39;,&#39;max_y&#39;,&#39;mean_z&#39;,&#39;min_z&#39;,&#39;max_z&#39;.</span>
<span class="sd">        - ax: Matplotlib axes, if not given auto picks.</span>
<span class="sd">        - period: Periodicity of potential in fraction between 0 and 1. For example if a slab is made of 4 super cells in z-direction, period=0.25.</span>
<span class="sd">        - lr_pos: Locations around which averages are taken.Default (0.25,0.75). Provide in fraction between 0 and 1. Center of period is located at these given fractions. Work only if period is given.</span>
<span class="sd">        - lr_widths: Default is [0.5,0.5], you may have slabs which have different lengths on left and right side. Provide a pair proportional to widths e.g (1,1), (1,1.1) etc. and it is auto normalized to 1. Works only if period is given.</span>
<span class="sd">        - labels: List of three labels for legend. Use plt.legend() or pp.add_legend() for labels to appear. First entry is data plot, second is its convolution and third is complete average.</span>
<span class="sd">        - colors: List of three colors for lines.</span>
<span class="sd">        - annotate: True by default, writes difference of right and left averages on plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean_x&#39;</span><span class="p">,</span><span class="s1">&#39;min_x&#39;</span><span class="p">,</span><span class="s1">&#39;max_x&#39;</span><span class="p">,</span><span class="s1">&#39;mean_y&#39;</span><span class="p">,</span><span class="s1">&#39;min_y&#39;</span><span class="p">,</span><span class="s1">&#39;max_y&#39;</span><span class="p">,</span><span class="s1">&#39;mean_z&#39;</span><span class="p">,</span><span class="s1">&#39;min_z&#39;</span><span class="p">,</span><span class="s1">&#39;max_z&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;`operation` excepts any of </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">check</span><span class="p">,</span><span class="n">operation</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">init_figure</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">e_or_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;`e_or_m` not given, trying to autopick LOCPOT...&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">export_potential</span><span class="p">()</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">basis</span>
            <span class="n">e_or_m</span><span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">e</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not auto fix. Make sure `basis` and `e_or_m` are provided.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;min&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;_x&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;_y&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;_z&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;max&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;_x&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;_y&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;_z&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1">#mean by default</span>
        <span class="k">if</span> <span class="s1">&#39;_x&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;_y&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;_z&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">pot</span> <span class="o">=</span> <span class="n">e_or_m</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Direction axis</span>
    <span class="k">if</span> <span class="s1">&#39;_x&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
    <span class="k">if</span> <span class="s1">&#39;_y&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">basis</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
    <span class="k">if</span> <span class="s1">&#39;_z&#39;</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">basis</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pot</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Potential plot</span>
    <span class="n">ret_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;direction&#39;</span><span class="p">:</span><span class="n">operation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]}</span>
    <span class="c1"># Only go below if periodicity is given</span>
    <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret_dict</span><span class="p">)</span> <span class="c1"># Simple Return</span>
    <span class="k">if</span> <span class="n">period</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">period</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">period</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
        <span class="n">arr_con</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">pot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">period</span><span class="p">,))</span><span class="o">/</span><span class="n">period</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
        <span class="n">x_con</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_con</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_con</span><span class="p">,</span><span class="n">arr_con</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Convolved plot</span>
        <span class="c1"># Find Averages</span>
        <span class="n">left</span><span class="p">,</span><span class="n">right</span> <span class="o">=</span> <span class="n">lr_pos</span>
        <span class="n">ind_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">left</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
        <span class="n">ind_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pot</span><span class="p">))</span>
        <span class="n">lr_widths</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">lr_widths</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lr_widths</span><span class="p">]</span> <span class="c1"># Normalize widths</span>
        <span class="n">div_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">period</span><span class="o">*</span><span class="n">lr_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># left half range</span>
        <span class="n">div_2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">period</span><span class="o">*</span><span class="n">lr_widths</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># right half range</span>
        <span class="n">v_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pot</span><span class="p">[</span><span class="n">ind_1</span><span class="o">-</span><span class="n">div_1</span><span class="p">:</span><span class="n">ind_1</span><span class="o">+</span><span class="n">div_1</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">v_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pot</span><span class="p">[</span><span class="n">ind_2</span><span class="o">-</span><span class="n">div_2</span><span class="p">:</span><span class="n">ind_2</span><span class="o">+</span><span class="n">div_2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">ret_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;left&#39;</span><span class="p">:{</span><span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v_1</span><span class="p">),</span><span class="s1">&#39;av_range&#39;</span><span class="p">:[</span><span class="n">ind_1</span><span class="o">-</span><span class="n">div_1</span><span class="p">,</span><span class="n">ind_1</span><span class="o">+</span><span class="n">div_1</span><span class="p">]}})</span>
        <span class="n">ret_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;right&#39;</span><span class="p">:{</span><span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v_2</span><span class="p">),</span><span class="s1">&#39;av_range&#39;</span><span class="p">:[</span><span class="n">ind_2</span><span class="o">-</span><span class="n">div_2</span><span class="p">,</span><span class="n">ind_2</span><span class="o">+</span><span class="n">div_2</span><span class="p">]}})</span>
        <span class="n">ret_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;deltav&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v_2</span><span class="o">-</span><span class="n">v_1</span><span class="p">)})</span>
        <span class="c1">#Level plot</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ind_1</span><span class="o">+</span><span class="n">ind_2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">ind_1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">middle</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">middle</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">ind_2</span><span class="p">]],[</span><span class="n">v_1</span><span class="p">,</span><span class="n">v_1</span><span class="p">,</span><span class="n">v_2</span><span class="p">,</span><span class="n">v_2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="c1"># Thick Plots</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">ind_1</span><span class="o">-</span><span class="n">div_1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">ind_1</span><span class="o">+</span><span class="n">div_1</span><span class="p">]],[</span><span class="n">v_1</span><span class="p">,</span><span class="n">v_1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">ind_2</span><span class="o">-</span><span class="n">div_2</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">ind_2</span><span class="o">+</span><span class="n">div_2</span><span class="p">]],[</span><span class="n">v_2</span><span class="p">,</span><span class="n">v_2</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Annotate</span>
        <span class="k">if</span> <span class="n">annotate</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.07</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\Delta _{R,L} = </span><span class="si">%9.6f</span><span class="s1">$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v_2</span><span class="o">-</span><span class="n">v_1</span><span class="p">,</span><span class="mi">6</span><span class="p">)),</span><span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; (&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u212B</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;)$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">vp</span><span class="o">.</span><span class="n">Dict2Data</span><span class="p">(</span><span class="n">ret_dict</span><span class="p">))</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Abdul Saboor

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>